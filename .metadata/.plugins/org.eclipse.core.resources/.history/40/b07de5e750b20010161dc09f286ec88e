package quanly;
import java.util.*;
import java.util.stream.Collectors;
public class QuanLyNhanVien {
	private List<NhanVien> dsnv; 
	
	//construct 
	public QuanLyNhanVien() { 
		dsnv  = new ArrayList<>(); 
	}
	// hien thi danh sach 
	public void hienThiDanhsach() {
		if(dsnv.isEmpty()) {  
			throw new IllegalArgumentException("danh sach khong duoc rong ") ;  
		}
		 for(NhanVien n : dsnv  ) { 
			 System.out.println(n);
		 }
	}
	// them nhan vien 
	public NhanVien themNhanVien(NhanVien nv ) { 
		if(nv == null ) return null ; 
		if(timKiemNhanVien(nv.getMaSoNV()) == null ) { 
			 dsnv.add(nv) ;
			 return nv ; 
		}
		return null   ; 
		
	}
	public NhanVien xoaNhanVien(String maSoNV) {  
		NhanVien nv = timKiemNhanVien(maSoNV) ; 
		if(nv != null) { 
			dsnv.remove(nv) ; 
			return nv ; 
		}
		return null;
		 
	}
	
	public NhanVien timKiemNhanVien(String maSoNV) {  
		return dsnv.stream()
				.filter(p->p.getMaSoNV().equalsIgnoreCase(maSoNV))
				.findFirst()
				.orElse(null) ; 
			
	}
	// phuong thuc thong ke trung binh 
	public Map<String , Double> thongKeLuongTrungBinh() {  
		Map<String , Double> ketQua = new HashMap<>()  ; 
		double tongLuongVanPhong = 0 ; 
		double tongLuongBanHang = 0 ; 
		int soVanPhong = 0 ; 
		int soBanHang =  0 ; 
		for(NhanVien nv : dsnv) { 
			if(nv instanceof NhanVienVanPhong) {  // instanceof 
			    tongLuongVanPhong += nv.tinhLuong();
			    soVanPhong++; 
			}else if (nv instanceof NhanVienBanHang) {
				tongLuongBanHang += nv.tinhLuong();
				soBanHang++ ; 
			}
		}
		if(soVanPhong > 0 )  
			ketQua.put("Nhan Vien Van Phong ", tongLuongVanPhong/soVanPhong); 
		if(soBanHang > 0 )
			ketQua.put("Nhan Vien Ban Hang", tongLuongBanHang/ soBanHang) ; 
		return ketQua  ; 
	}
	
	public List<NhanVien> getDSNhanVienThuNhapTangThem() {
	    return dsnv.stream()
	        .filter(nv -> nv instanceof NhanVienBanHang)
	        .map(nv -> (NhanVienBanHang) nv)
	        .filter(bh -> bh.thuNhapTangThem == 0 )
	        .sorted((a, b) -> Double.compare(b.getDoanhSoBan(), a.getDoanhSoBan()))
	        .collect(Collectors.toList());
	}
 

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	public String inTieuDe() {  
		 return String.format(
				 "%-8s | %-15s | %-12s | %-15s", 
				 "MSNV" , "HoVaTen" , "SDT" , "Luong co ban ") ; 
		 
	}
	
	
	
}
