package qlhp;

import java.text.DecimalFormat;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Objects;

public abstract class HocPhan {
    protected final String mssv;
    protected String hoTen;
    protected double hocPhi;
    protected LocalDate ngayBatDau;
    protected LocalDate ngayKetThuc;
    protected double diemMucTieu;
    protected double ketQua;

    // Default constructor
    public HocPhan() {
        this.mssv = "";
        this.hoTen = "";
        this.hocPhi = 0.0;
        this.ngayBatDau = LocalDate.now();
        this.ngayKetThuc = LocalDate.now();
        this.diemMucTieu = 0.0;
        this.ketQua = 0.0;
    }

    // Parameterized constructor
    public HocPhan(
            String mssv,
            String hoTen,
            double hocPhi,
            LocalDate ngayBatDau,
            LocalDate ngayKetThuc,
            double diemMucTieu,
            double ketQua) {

        // Use logical OR (||) for boolean checks
        if (mssv == null || mssv.trim().isEmpty()) {
            throw new IllegalArgumentException("Mã số sinh viên không được rỗng.");
        }
        if (diemMucTieu < 0 || diemMucTieu > 990) {
            throw new IllegalArgumentException("Điểm mục tiêu phải trong khoảng từ 0 đến 990.");
        }
        if (ngayKetThuc.isBefore(ngayBatDau)) {
            throw new IllegalArgumentException("Ngày kết thúc phải sau ngày bắt đầu.");
        }
        
        this.mssv = mssv.trim();
        this.hoTen = hoTen;
        this.hocPhi = hocPhi;
        this.ngayBatDau = ngayBatDau;
        this.ngayKetThuc = ngayKetThuc;
        this.diemMucTieu = diemMucTieu;
        this.ketQua = ketQua;
    }

    // --- Getters and Setters ---
    public String getHoTen() {
        return hoTen;
    }

    public void setHoTen(String hoTen) {
        this.hoTen = hoTen;
    }

    public double getHocPhi() {
        return hocPhi;
    }

    public void setHocPhi(double hocPhi) {
        this.hocPhi = hocPhi;
    }

    public LocalDate getNgayBatDau() {
        return ngayBatDau;
    }

    public void setNgayBatDau(LocalDate ngayBatDau) {
        this.ngayBatDau = ngayBatDau;
    }

    public LocalDate getNgayKetThuc() {
        return ngayKetThuc;
    }

    public void setNgayKetThuc(LocalDate ngayKetThuc) {
        if (ngayKetThuc.isBefore(ngayBatDau)) {
            throw new IllegalArgumentException("Ngày kết thúc phải sau ngày bắt đầu.");
        }
        this.ngayKetThuc = ngayKetThuc;
    }

    public double getDiemMucTieu() {
        return diemMucTieu;
    }

    public void setDiemMucTieu(double diemMucTieu) {
        if (diemMucTieu < 0 || diemMucTieu > 990) {
            throw new IllegalArgumentException("Điểm mục tiêu phải trong khoảng từ 0 đến 990.");
        }
        this.diemMucTieu = diemMucTieu;
    }

    public double getKetQua() {
        return ketQua;
    }

    public void setKetQua(double ketQua) {
        this.ketQua = ketQua;
    }

    public String getMssv() {
        return mssv;
    }
    public double tinhTienThuong() { 
    	if(this.ketQua > this.diemMucTieu) {  
    		return (this.ketQua- this.diemMucTieu) * 2000 ; 
    	}
    	return 0; 
    }

    // Abstract method to be implemented by subclasses
    public abstract double tinhHocPhi();

    @Override
    public String toString() {
        // Corrected format string with the 'hocPhi' argument included
        return String.format("%-7s | %-15s | %12.0f | %12s | %12s |    %10.0f | %10.0f | %12.0f |",
                this.mssv,
                this.hoTen,
                this.hocPhi, // This argument was missing
                ngayBatDau.format(DateTimeFormatter.ofPattern("yyyy-MM-dd")),
                ngayKetThuc.format(DateTimeFormatter.ofPattern("yyyy-MM-dd")),
                this.diemMucTieu,
                this.ketQua,
                this.tinhTienThuong() 
                
        		);
    }

    @Override
    public int hashCode() {
        return Objects.hash(diemMucTieu, hoTen, hocPhi, ketQua, mssv, ngayBatDau, ngayKetThuc);
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        HocPhan other = (HocPhan) obj;
        return Double.compare(other.diemMucTieu, diemMucTieu) == 0 &&
               Double.compare(other.hocPhi, hocPhi) == 0 &&
               Double.compare(other.ketQua, ketQua) == 0 &&
               Objects.equals(mssv, other.mssv) &&
               Objects.equals(hoTen, other.hoTen) &&
               Objects.equals(ngayBatDau, other.ngayBatDau) &&
               Objects.equals(ngayKetThuc, other.ngayKetThuc);
    }
}